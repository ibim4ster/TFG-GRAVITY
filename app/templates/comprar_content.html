<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compra de Licencias</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/comprar_content.css') }}">
  <!-- PayPal SDK SANDBOX -->
  <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>
</head>

<body>
  <h2 class="centered">Compra de Licencias</h2>
  <div class="license-container">
    <!-- Licencia Mensual -->
    <div class="license-card monthly">
      <h3>Licencia Mensual</h3>
      <div class="icon">
        <i class="fas fa-calendar-alt" aria-hidden="true"></i>
      </div>
      <div class="description">
        Acceso completo a la búsqueda de datos durante 1 mes.
      </div>
      <div class="price">$9.99</div>
      <p>Duración: 30 días</p>
      <div class="cta-button">
        <div id="paypal-button-container-mensual"></div>
      </div>
    </div>
    <!-- Licencia Anual -->
    <div class="license-card annual">
      <h3>Licencia Anual</h3>
      <div class="icon">
        <i class="fas fa-calendar" aria-hidden="true"></i>
      </div>
      <div class="description">
        Acceso completo a la búsqueda de datos durante 1 año.
      </div>
      <div class="price">$99.99</div>
      <p>Duración: 1 año</p>
      <div class="cta-button">
        <div id="paypal-button-container-anual"></div>
      </div>
    </div>
    <!-- Licencia Permanente -->
    <div class="license-card permanent">
      <h3>Licencia Permanente</h3>
      <div class="icon">
        <i class="fas fa-infinity" aria-hidden="true"></i>
      </div>
      <div class="description">
        Acceso completo a la búsqueda de datos para siempre.
      </div>
      <div class="price">$299.99</div>
      <p>Duración: Para siempre</p>
      <div class="cta-button">
        <div id="paypal-button-container-permanente"></div>
      </div>
    </div>
  </div>
  <div class="payment-text">
    <p>Se aceptan pagos con</p>
  </div>
  <div class="payment-logos">
    <i class="fab fa-cc-visa" aria-hidden="true"></i>
    <i class="fab fa-cc-mastercard" aria-hidden="true"></i>
    <i class="fab fa-cc-paypal" aria-hidden="true"></i>
    <i class="fab fa-apple-pay" aria-hidden="true"></i>
    <i class="fab fa-cc-amex" aria-hidden="true"></i>
  </div>

  <script>
    function activarLicencia(tipo) {
      fetch('/licenses/activate_paypal', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ tipo: tipo })
      })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            window.location.href = "/licenses/compra_exitosa";
          } else {
            alert("Error al activar la licencia: " + (data.error || "Desconocido"));
          }
        })
        .catch(error => {
          console.error("Error:", error);
          alert("Hubo un problema al procesar tu compra. Por favor, inténtalo de nuevo.");
        });
    }

    // Render PayPal buttons when page is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Botón para Licencia Mensual (gris)
      paypal.Buttons({
        style: { layout: 'vertical', color: 'silver', shape: 'pill', label: 'paypal' },
        createOrder: function (data, actions) {
          return actions.order.create({
            purchase_units: [{
              amount: { value: '9.99' },
              description: 'Licencia Mensual'
            }]
          });
        },
        onApprove: function (data, actions) {
          return actions.order.capture().then(function (details) {
            activarLicencia('Mensual');
          });
        }
      }).render('#paypal-button-container-mensual');

      // Botón para Licencia Anual (azul)
      paypal.Buttons({
        style: { layout: 'vertical', color: 'blue', shape: 'pill', label: 'paypal' },
        createOrder: function (data, actions) {
          return actions.order.create({
            purchase_units: [{
              amount: { value: '99.99' },
              description: 'Licencia Anual'
            }]
          });
        },
        onApprove: function (data, actions) {
          return actions.order.capture().then(function (details) {
            activarLicencia('Anual');
          });
        }
      }).render('#paypal-button-container-anual');

      // Botón para Licencia Permanente (amarillo)
      paypal.Buttons({
        style: { layout: 'vertical', color: 'gold', shape: 'pill', label: 'paypal' },
        createOrder: function (data, actions) {
          return actions.order.create({
            purchase_units: [{
              amount: { value: '299.99' },
              description: 'Licencia Permanente'
            }]
          });
        },
        onApprove: function (data, actions) {
          return actions.order.capture().then(function (details) {
            activarLicencia('Permanente');
          });
        }
      }).render('#paypal-button-container-permanente');
    });
  </script>
</body>

</html>